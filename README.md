# ğŸ¤– í‚¤ì›€ì¦ê¶Œ ìë™ë§¤ë§¤ ì‹œìŠ¤í…œ

[![Python](https://img.shields.io/badge/Python-3.10+-blue.svg)](https://www.python.org/downloads/)
[![License](https://img.shields.io/badge/License-MIT-green.svg)](LICENSE)
[![Code style: black](https://img.shields.io/badge/code%20style-black-000000.svg)](https://github.com/psf/black)

í‚¤ì›€ì¦ê¶Œ OpenAPIë¥¼ í™œìš©í•œ êµ­ë‚´ ì£¼ì‹ ìë™ë§¤ë§¤ ì‹œìŠ¤í…œì…ë‹ˆë‹¤. Playwrightë¡œ ì¢…ëª©ì„ ì„ ì •í•˜ê³ , REST APIë¡œ ì£¼ë¬¸ì„ ì‹¤í–‰í•˜ë©°, WebSocketìœ¼ë¡œ ì‹¤ì‹œê°„ ì‹œì„¸ë¥¼ ëª¨ë‹ˆí„°ë§í•˜ì—¬ ìë™ìœ¼ë¡œ ë§¤ë„í•©ë‹ˆë‹¤.

## âœ¨ ì£¼ìš” ê¸°ëŠ¥

- ğŸ” **ì‹¤ì‹œê°„ ì¢…ëª© ìŠ¤í¬ë˜í•‘**: Playwrightë¥¼ ì´ìš©í•œ ì¥ ì‹œì‘ í›„ ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§ (09:00~09:10)
- ğŸ“Š **ìë™ ë§¤ìˆ˜**: ë§¤ìˆ˜ ì¡°ê±´ ì¶©ì¡± ì‹œ ì‹œì¥ê°€ ì£¼ë¬¸ ìë™ ì‹¤í–‰
- ğŸ’° **ìë™ ë§¤ë„**: ëª©í‘œ ìˆ˜ìµë¥ (2%) ë„ë‹¬ ì‹œ ìë™ ë§¤ë„
- ğŸ”„ **ë¬´í•œ ì—°ê²° ìœ ì§€**: WebSocket PING/PONG ì²˜ë¦¬ë¡œ ì—°ê²° ëŠê¹€ ì—†ìŒ
- ğŸ›¡ï¸ **ì•ˆì „ì¥ì¹˜**: ì¼ì¼ 1íšŒ ë§¤ìˆ˜ ì œí•œ, ì¤‘ë³µ ë§¤ë„ ë°©ì§€
- ğŸ“± **ë¸Œë¼ìš°ì € ë…ë¦½**: ë§¤ìˆ˜ í›„ ë¸Œë¼ìš°ì € ì—†ì´ë„ ë§¤ë„ ëª¨ë‹ˆí„°ë§ ê°€ëŠ¥

## ğŸš€ ë¹ ë¥¸ ì‹œì‘

### 1. ì„¤ì¹˜

```bash
# ì €ì¥ì†Œ í´ë¡ 
git clone https://github.com/ralph0830/kiwoom-stock.git
cd kiwoom-stock

# UV íŒ¨í‚¤ì§€ ë§¤ë‹ˆì € ì„¤ì¹˜ (ì„ íƒì‚¬í•­)
curl -LsSf https://astral.sh/uv/install.sh | sh

# ì˜ì¡´ì„± ì„¤ì¹˜
uv sync
```

### 2. í™˜ê²½ ë³€ìˆ˜ ì„¤ì •

`.env` íŒŒì¼ì„ ìƒì„±í•˜ê³  í‚¤ì›€ì¦ê¶Œ API í‚¤ë¥¼ ì…ë ¥í•˜ì„¸ìš”:

```bash
# ëª¨ì˜íˆ¬ì/ì‹¤ì „íˆ¬ì ì„ íƒ
USE_MOCK=false

# ì‹¤ì „íˆ¬ì API í‚¤
KIWOOM_APP_KEY=your_real_app_key
KIWOOM_SECRET_KEY=your_real_secret_key

# ëª¨ì˜íˆ¬ì API í‚¤
KIWOOM_MOCK_APP_KEY=your_mock_app_key
KIWOOM_MOCK_SECRET_KEY=your_mock_secret_key

# ê³„ì¢Œ ì •ë³´
ACCOUNT_NO=12345678-01
MAX_INVESTMENT=100000
```

### 3. ì‹¤í–‰

```bash
# ìë™ë§¤ë§¤ ì‹œì‘
uv run python auto_trading.py

# ë˜ëŠ” ì¼ë°˜ Pythonìœ¼ë¡œ ì‹¤í–‰
python auto_trading.py
```

## ğŸ“– ì‚¬ìš© ë°©ë²•

### ê¸°ë³¸ ì›Œí¬í”Œë¡œìš°

1. **ì‹œìŠ¤í…œ ì‹œì‘** (09:00)
   - ë¸Œë¼ìš°ì € ìë™ ì‹¤í–‰
   - ì˜¤ëŠ˜ ë§¤ìˆ˜ ì´ë ¥ í™•ì¸

2. **ë§¤ìˆ˜ ëª¨ë‹ˆí„°ë§** (09:00~09:10)
   - 0.5ì´ˆë§ˆë‹¤ ì¢…ëª© ë°ì´í„° ìŠ¤í¬ë˜í•‘
   - ë§¤ìˆ˜ê°€ ë„ë‹¬ ì‹œ ìë™ ì£¼ë¬¸

3. **ë§¤ë„ ëª¨ë‹ˆí„°ë§** (ë¬´ì œí•œ)
   - WebSocket ì‹¤ì‹œê°„ ì‹œì„¸ ìˆ˜ì‹ 
   - 2% ìˆ˜ìµë¥  ë„ë‹¬ ì‹œ ìë™ ë§¤ë„

### ì¬ì‹œì‘ ì‹œ (ë§¤ìˆ˜ ì™„ë£Œ í›„)

ì‹œìŠ¤í…œì´ ì¢…ë£Œë˜ì–´ë„ `daily_trading_lock.json`ì—ì„œ ë§¤ìˆ˜ ì •ë³´ë¥¼ ë³µì›í•˜ì—¬ ìë™ìœ¼ë¡œ ë§¤ë„ ëª¨ë‹ˆí„°ë§ì„ ì¬ê°œí•©ë‹ˆë‹¤.

```bash
# ë¸Œë¼ìš°ì € ì—†ì´ ë§¤ë„ ëª¨ë‹ˆí„°ë§ë§Œ ì‹œì‘
uv run python auto_trading.py
```

## ğŸ—ï¸ ì‹œìŠ¤í…œ êµ¬ì¡°

```
kiwoom-stock/
â”œâ”€â”€ auto_trading.py          # ë©”ì¸ ìë™ë§¤ë§¤ ì‹œìŠ¤í…œ
â”œâ”€â”€ kiwoom_order.py          # REST API ì£¼ë¬¸ ì²˜ë¦¬
â”œâ”€â”€ kiwoom_websocket.py      # WebSocket ì‹¤ì‹œê°„ ì‹œì„¸
â”œâ”€â”€ daily_trading_lock.json  # ì¼ì¼ ë§¤ìˆ˜ ì´ë ¥ (ìë™ ìƒì„±)
â”œâ”€â”€ trading_results/         # ë§¤ë§¤ ê²°ê³¼ ê¸°ë¡ (ìë™ ìƒì„±)
â”œâ”€â”€ .env                     # í™˜ê²½ ë³€ìˆ˜ (ì§ì ‘ ì‘ì„± í•„ìš”)
â”œâ”€â”€ .gitignore               # Git ì œì™¸ íŒŒì¼
â”œâ”€â”€ pyproject.toml           # í”„ë¡œì íŠ¸ ì„¤ì •
â””â”€â”€ README.md                # ë³¸ ë¬¸ì„œ
```

## ğŸ”§ í•µì‹¬ ì»´í¬ë„ŒíŠ¸

### AutoTradingSystem (`auto_trading.py`)

ì „ì²´ ìë™ë§¤ë§¤ í”„ë¡œì„¸ìŠ¤ë¥¼ ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜í•©ë‹ˆë‹¤.

```python
# ì£¼ìš” ë©”ì„œë“œ
- start_auto_trading()        # ë¸Œë¼ìš°ì € + WebSocket ë§¤ë§¤ ì‹œì‘
- start_sell_monitoring()     # WebSocket ì „ìš© ë§¤ë„ ëª¨ë‹ˆí„°ë§
- execute_auto_buy()          # ìë™ ë§¤ìˆ˜ ì£¼ë¬¸
- execute_auto_sell()         # ìë™ ë§¤ë„ ì£¼ë¬¸
- on_price_update()           # ì‹¤ì‹œê°„ ì‹œì„¸ ì½œë°±
```

### KiwoomOrderAPI (`kiwoom_order.py`)

REST APIë¥¼ í†µí•œ ì£¼ë¬¸ ì‹¤í–‰ ë° ì¸ì¦ì„ ë‹´ë‹¹í•©ë‹ˆë‹¤.

```python
# ì£¼ìš” ë©”ì„œë“œ
- get_access_token()          # OAuth2 í† í° ë°œê¸‰
- place_market_buy()          # ì‹œì¥ê°€ ë§¤ìˆ˜
- place_market_sell()         # ì‹œì¥ê°€ ë§¤ë„
```

### KiwoomWebSocket (`kiwoom_websocket.py`)

WebSocketì„ í†µí•œ ì‹¤ì‹œê°„ ì‹œì„¸ ìˆ˜ì‹  ë° ì—°ê²° ê´€ë¦¬ë¥¼ ë‹´ë‹¹í•©ë‹ˆë‹¤.

```python
# ì£¼ìš” ë©”ì„œë“œ
- connect()                   # WebSocket ì—°ê²° ë° ë¡œê·¸ì¸
- register_stock()            # ì‹¤ì‹œê°„ ì‹œì„¸ ë“±ë¡
- receive_loop()              # ë°ì´í„° ìˆ˜ì‹  + ìë™ ì¬ì—°ê²°
```

## ğŸ“Š ë§¤ë§¤ íë¦„ë„

```
[ì‹œìŠ¤í…œ ì‹œì‘]
    â†“
[ë§¤ìˆ˜ ì´ë ¥ í™•ì¸]
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ë§¤ìˆ˜ O  â”‚ ë§¤ìˆ˜ X  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“           â†“
[WebSocket] [Playwright]
    â†“           â†“
[ë§¤ë„ ê°ì‹œ] [ë§¤ìˆ˜ ê°ì‹œ]
    â†“           â†“
    â”‚       [ì£¼ë¬¸ ì‹¤í–‰]
    â”‚           â†“
    â””â”€â”€â”€â”€â”€â”€â”€[WebSocket]
                â†“
            [ë§¤ë„ ê°ì‹œ]
                â†“
            [ëª©í‘œ ë‹¬ì„±]
                â†“
            [ë§¤ë„ ì‹¤í–‰]
                â†“
            [ì‹œìŠ¤í…œ ì¢…ë£Œ]
```

## ğŸ›¡ï¸ ì•ˆì „ì¥ì¹˜

### 1. ì¼ì¼ 1íšŒ ë§¤ìˆ˜ ì œí•œ

```python
# daily_trading_lock.jsonìœ¼ë¡œ ë‚ ì§œ ì¶”ì 
{
  "last_trading_date": "20251017",
  "stock_code": "051780",
  "buy_price": 1625,
  "quantity": 1230
}
```

### 2. ì¤‘ë³µ ë§¤ë„ ë°©ì§€

```python
# ì´ì¤‘ í”Œë˜ê·¸ ì‹œìŠ¤í…œ
if self.sell_executed:
    return  # ì´ë¯¸ ë§¤ë„í•¨

self.sell_executed = True  # ì¦‰ì‹œ í”Œë˜ê·¸ ì„¤ì •
# ë§¤ë„ ì£¼ë¬¸ ì‹¤í–‰
```

### 3. WebSocket ì—°ê²° ì•ˆì •ì„±

```python
# PING ì‘ë‹µ ì²˜ë¦¬
if data.get("trnm") == "PING":
    await self.websocket.send(message)

# ìë™ ì¬ì—°ê²°
if not self.is_connected:
    await asyncio.sleep(2)
    await self.connect()
```

## âš™ï¸ í™˜ê²½ë³„ ì„¤ì •

### ëª¨ì˜íˆ¬ì

```bash
USE_MOCK=true
```

- URL: `https://mockapi.kiwoom.com`
- WebSocket: `wss://mockapi.kiwoom.com:10000`
- ì§€ì› ê±°ë˜ì†Œ: KRXë§Œ

### ì‹¤ì „íˆ¬ì

```bash
USE_MOCK=false
```

- URL: `https://api.kiwoom.com`
- WebSocket: `wss://api.kiwoom.com:10000`
- ì§€ì› ê±°ë˜ì†Œ: ì „ì²´

## ğŸ“ˆ ì„±ëŠ¥ ì§€í‘œ

| í•­ëª© | ê°’ |
|------|-----|
| ì›¹ ìŠ¤í¬ë˜í•‘ ì£¼ê¸° | 0.5ì´ˆ |
| WebSocket ì—°ê²° ìœ ì§€ | ë¬´ì œí•œ |
| ì¬ì—°ê²° ëŒ€ê¸° ì‹œê°„ | 2ì´ˆ |
| API ì‘ë‹µ ì‹œê°„ | ~100ms |
| ì£¼ë¬¸ ì‹¤í–‰ ì‹œê°„ | ~200ms |

## ğŸ› íŠ¸ëŸ¬ë¸”ìŠˆíŒ…

### WebSocket 40ì´ˆ í›„ ì—°ê²° ëŠê¹€

**ì›ì¸**: PING ë©”ì‹œì§€ ë¯¸ì‘ë‹µ

**í•´ê²°**: ì´ë¯¸ PING/PONG ì²˜ë¦¬ êµ¬í˜„ë˜ì–´ ìˆìŒ (kiwoom_websocket.py:171-176)

### ë¸Œë¼ìš°ì € ë‹«ìœ¼ë©´ ë§¤ë„ ì•ˆë¨

**ì›ì¸**: ë¸Œë¼ìš°ì € ì¢…ë£Œ ì‹œ ì‹œìŠ¤í…œ ì¢…ë£Œ

**í•´ê²°**: `daily_trading_lock.json`ì—ì„œ ë§¤ìˆ˜ ì •ë³´ ë³µì›í•˜ì—¬ WebSocketë§Œìœ¼ë¡œ ë§¤ë„ ëª¨ë‹ˆí„°ë§

### í•˜ë£¨ì— ì—¬ëŸ¬ ë²ˆ ë§¤ìˆ˜ë¨

**ì›ì¸**: ë§¤ìˆ˜ ì´ë ¥ ì¶”ì  ì—†ìŒ

**í•´ê²°**: `check_today_trading_done()` í•¨ìˆ˜ë¡œ ì¼ì¼ 1íšŒ ì²´í¬

## ğŸ“š ìƒì„¸ ë¬¸ì„œ

ë” ìì„¸í•œ ê¸°ìˆ  ë¬¸ì„œëŠ” [PRD.md](PRD.md)ë¥¼ ì°¸ê³ í•˜ì„¸ìš”.

- API ëª…ì„¸
- ë°ì´í„° êµ¬ì¡°
- ì•Œê³ ë¦¬ì¦˜ ìƒì„¸
- ì—ëŸ¬ ì²˜ë¦¬
- ì„±ëŠ¥ ìµœì í™”

## âš ï¸ ì£¼ì˜ì‚¬í•­

### íˆ¬ì ê²½ê³ 

> **ë³¸ ì‹œìŠ¤í…œì€ êµìœ¡ ë° ì—°êµ¬ ëª©ì ìœ¼ë¡œ ì œì‘ë˜ì—ˆìŠµë‹ˆë‹¤.**
>
> - ì‹¤ì œ íˆ¬ì ì‹œ ë°œìƒí•˜ëŠ” ëª¨ë“  ì†ì‹¤ì€ ì‚¬ìš©ì ë³¸ì¸ì˜ ì±…ì„ì…ë‹ˆë‹¤
> - ìë™ë§¤ë§¤ëŠ” ì˜ˆìƒì¹˜ ëª»í•œ ì†ì‹¤ì„ ì´ˆë˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤
> - ì¶©ë¶„í•œ í…ŒìŠ¤íŠ¸ ì—†ì´ ì‹¤ì „íˆ¬ì ì‚¬ìš©ì„ ê¶Œì¥í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤
> - **ëª¨ì˜íˆ¬ìë¡œ ì¶©ë¶„íˆ ê²€ì¦í•œ í›„ ì‹¤ì „íˆ¬ìë¥¼ ê³ ë ¤í•˜ì„¸ìš”**

### ë²•ì  ê³ ì§€

- í‚¤ì›€ì¦ê¶Œ API ì´ìš©ì•½ê´€ ì¤€ìˆ˜ í•„ìˆ˜
- ê³¼ë„í•œ API í˜¸ì¶œ ìì œ
- ê°œì¸ì •ë³´ ë³´í˜¸ë²• ì¤€ìˆ˜ (API í‚¤ ë…¸ì¶œ ê¸ˆì§€)
- `.env` íŒŒì¼ì„ ì ˆëŒ€ ê³µê°œí•˜ì§€ ë§ˆì„¸ìš”

## ğŸ” ë³´ì•ˆ

### API í‚¤ ê´€ë¦¬

```bash
# .env íŒŒì¼ì€ ì ˆëŒ€ Gitì— ì»¤ë°‹í•˜ì§€ ë§ˆì„¸ìš”
# .gitignoreì— ì´ë¯¸ í¬í•¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤

.env
daily_trading_lock.json
trading_results/
*.log
```

### ë¯¼ê° ì •ë³´ ì œì™¸

- API í‚¤ ë° Secret
- ê³„ì¢Œ ë²ˆí˜¸
- ë§¤ë§¤ ê¸°ë¡
- ë¡œê·¸ íŒŒì¼

## ğŸ› ï¸ ê°œë°œ í™˜ê²½

```toml
[project]
name = "kiwoom-stock"
version = "1.0.0"
requires-python = ">=3.10"

dependencies = [
    "playwright>=1.42.0",
    "websockets>=12.0",
    "requests>=2.31.0",
    "python-dotenv>=1.0.0",
]
```

## ğŸ¤ ê¸°ì—¬í•˜ê¸°

ë²„ê·¸ ë¦¬í¬íŠ¸ë‚˜ ê¸°ëŠ¥ ì œì•ˆì€ [Issues](https://github.com/ralph0830/kiwoom-stock/issues)ì— ë“±ë¡í•´ ì£¼ì„¸ìš”.

## ğŸ“„ ë¼ì´ì„ ìŠ¤

MIT License - ììœ ë¡­ê²Œ ì‚¬ìš©, ìˆ˜ì •, ë°°í¬ ê°€ëŠ¥í•©ë‹ˆë‹¤.

## ğŸ™ ê°ì‚¬ì˜ ë§

- [í‚¤ì›€ì¦ê¶Œ](https://www.kiwoom.com/) - OpenAPI ì œê³µ
- [Playwright](https://playwright.dev/) - ë¸Œë¼ìš°ì € ìë™í™”
- [websockets](https://websockets.readthedocs.io/) - WebSocket ë¼ì´ë¸ŒëŸ¬ë¦¬

---

**ê°œë°œ**: Ralph
**ë„ì›€**: Claude Code
**ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸**: 2025-10-17
**ë²„ì „**: 1.0.0
